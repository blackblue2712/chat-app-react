{"ast":null,"code":"var _jsxFileName = \"/opt/lampp/htdocs/STUDY_SPACE/chat-app/src/chats/ChatArea.js\";\nimport React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport ItemMessage from '../chats/ItemMessage'; // import ItemMessageAttachment from '../chats/ItemMessageAttachment';\n\nimport Template from '../component/TemplateWithNavigation';\nimport socketIOClient from 'socket.io-client';\nimport { getUserById } from '../controllers/UserController';\nimport { getMessageIndividualUser, postSavePrivateMessage } from '../controllers/PrivateChat';\n\nconst moment = require(\"moment\");\n\nclass ChatArea extends React.Component {\n  constructor() {\n    super();\n\n    this.handleSendMessageFromIndividualUser = () => {\n      try {\n        window.event.preventDefault();\n        let textMessage = document.getElementById(\"text-message\");\n\n        if (textMessage.value.trim() || this.formData.get(\"photo\")) {\n          let {\n            toUid\n          } = this.props.match.params;\n          let uid = this.props.userPayload.user._id; // let name = this.props.userPayload.user.fullname || this.props.userPayload.user.email;\n\n          let photo = this.props.userPayload.user.photo;\n          let token = this.props.userPayload.token; // emit event\n\n          this.socket.emit(\"client-send-message-from-individual-user\", {\n            to: toUid,\n            message: textMessage.value,\n            photo,\n            from: uid\n          }, () => {\n            this.setState({\n              messages: this.state.messages.concat({\n                isMe: \"me\",\n                content: textMessage.value\n              })\n            });\n            document.querySelector(`#dcs_${toUid} p`).innerText = textMessage.value;\n            textMessage.value = \"\";\n            this.scrollToBottom();\n          }); // save private message to db\n\n          this.formData.append(\"sender\", uid);\n          this.formData.append(\"receiver\", toUid);\n          this.formData.append(\"content\", textMessage.value);\n          postSavePrivateMessage(this.formData, token).then(res => {\n            console.log(res);\n            this.formData.delete(\"photo\");\n\n            if (res && res.urlContainImage) {// let dataImage = {\n              //   sender: {\n              //     _id: uid,\n              //     name,\n              //     photo: photo\n              //   },\n              //   photo: res.urlContainImage,\n              // }\n              // this.setState({\n              //   messageList: this.state.messageList.concat(dataImage)\n              // });\n              // dataImage.chanelId = chanelId;\n              // this.socket.emit(\"client-send-message-contain-image-from-individual-user\", dataImage, () => {\n              //   \n              // })\n            }\n          }).catch(err => console.log(err));\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.handleCreateConnectSocket = (data, userFriend) => {\n      try {\n        this.socket = socketIOClient(process.env.REACT_APP_API_URL, {\n          transports: ['websocket']\n        }); // wait client connect\n\n        this.socket.on('connect', () => {\n          this.socket.emit(\"join-individual\", {\n            uid: data.uid,\n            username: data.name\n          }, () => {\n            console.log(`user ${this.props.userPayload.user.email} joined`);\n          });\n          this.socket.on(\"server-send-message-from-individual-user\", res => {\n            if (res.from === userFriend._id) {\n              this.setState({\n                messages: this.state.messages.concat({\n                  content: res.message,\n                  photo: res.photo\n                })\n              });\n            }\n\n            document.querySelector(`#dcs_${res.from} p`).innerText = res.message;\n            console.log(`#dcs_${userFriend.uid} .count-unread span`);\n            let currentUnread = Number(document.querySelector(`#dcs_${userFriend._id} .count-unread span`).innerHTML) + 1;\n            console.log(\"currentUnread\", currentUnread);\n            this.showUnReadMessage(currentUnread, res.from);\n          });\n          this.socket.on(\"server-send-message-contain-image-from-individual-user\", res => {\n            if (res.from === userFriend._id) {\n              this.setState({\n                messages: this.state.messages.concat({\n                  content: res.message,\n                  photo: res.photo\n                })\n              });\n            }\n\n            console.log(\"server-send-message-contain-image-from-individual-user\", res.data);\n            document.querySelector(`#dcs_${res.from} p`).innerText = res.message;\n            let currentUnread = Number(document.querySelector(`#dcs_${userFriend._id} .count-unread span`).innerHTML) + 1;\n            this.showUnReadMessage(currentUnread, res.from);\n          });\n        });\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.getMessageIndividualUser = (senderId, receiverId, token) => {\n      getMessageIndividualUser(senderId, receiverId, token).then(res => {\n        console.log(res);\n\n        if (!res.message) {\n          let listMessage = [];\n          let countUnreadMessage = 0;\n          res.map(mes => {\n            let objMessage = {};\n            let isMe = mes.sender._id === senderId ? true : false;\n            objMessage.isMe = isMe === true ? \"me\" : \"\";\n            objMessage.content = mes.content;\n            objMessage.date = mes.created;\n            objMessage.photo = isMe === true ? mes.receiver.photo : mes.sender.photo;\n            if (mes.sender._id !== senderId && mes.isRead === false) countUnreadMessage += 1;\n            listMessage.push(objMessage);\n          });\n          this.setState({\n            messages: this.state.messages.concat(listMessage)\n          });\n          this.showUnReadMessage(countUnreadMessage, receiverId);\n        }\n      }).catch(err => {\n        console.log(err);\n      });\n    };\n\n    this.showUnReadMessage = (count, toUid) => {\n      try {\n        if (count > 0) {\n          document.querySelector(`#dcs_${toUid} .count-unread`).classList.add(\"on\");\n          document.querySelector(`#dcs_${toUid} .count-unread span`).innerHTML = count;\n        }\n      } catch (err) {\n        console.log(err);\n      }\n    };\n\n    this.showTypingAction = uTyping => {\n      try {\n        document.getElementById(\"typing-action\").classList.add(\"on\");\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.previewPhoto = event => {\n      let reader = new FileReader();\n      document.querySelector('.preview-image').classList.add(\"on\");\n      let inputAvatar = document.querySelector('.preview-image #preview');\n\n      reader.onload = function () {\n        inputAvatar.src = reader.result;\n      };\n\n      try {\n        reader.readAsDataURL(event.target.files[0]);\n        this.formData.append(\"photo\", event.target.files[0]);\n      } catch (e) {// do nothing\n      }\n    };\n\n    this.handlePasteToInput = event => {\n      try {\n        let items = (event.clipboardData || event.originalEvent.clipboardData).items; // find pasted image among pasted items\n\n        let blob = null;\n\n        for (let i = 0; i < items.length; i++) {\n          if (items[i].type.indexOf(\"image\") === 0) {\n            blob = items[i].getAsFile();\n          }\n        } // load image if there is a pasted image\n\n\n        if (blob !== null) {\n          let reader = new FileReader();\n\n          reader.onload = function (event) {\n            document.querySelector('.preview-image').classList.add(\"on\");\n            document.querySelector(\".preview-image #preview\").src = this.result;\n          };\n\n          reader.readAsDataURL(blob);\n          this.formData.append(\"photo\", blob);\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.clearFormDataImage = () => {\n      document.querySelector('.preview-image').classList.remove(\"on\");\n      document.querySelector('.preview-image #preview').src = \"\";\n      this.formData.delete(\"photo\");\n    };\n\n    this.checkUserEnter = e => {\n      if (e.keyCode === 13) {\n        try {\n          this.handleSendMessageFromIndividualUser();\n        } catch (e) {\n          console.log(e);\n        }\n      }\n    };\n\n    this.toggleDropdown = () => {\n      try {\n        let drdElement = document.querySelector(\"#chat-area .list-more\");\n\n        if (drdElement.classList.length > 2) {\n          drdElement.classList.remove(\"active\");\n        } else {\n          drdElement.classList.add(\"active\");\n          document.getElementById(\"root\").addEventListener(\"click\", () => {\n            drdElement.classList.remove(\"active\");\n          });\n        }\n      } catch (e) {}\n    };\n\n    this.scrollToBottom = () => {\n      try {\n        document.querySelector(\"#end-of-message\").scrollIntoView({\n          behavior: \"smooth\"\n        });\n      } catch (e) {}\n    };\n\n    this.state = {\n      messages: [],\n      onlineUser: [],\n      userFriend: {}\n    };\n    this.formData = new FormData();\n  }\n\n  async componentDidMount() {\n    try {\n      document.getElementById(\"text-message\").addEventListener(\"keyup\", this.checkUserEnter);\n      let {\n        toUid\n      } = this.props.match.params;\n      let uid = this.props.userPayload.user._id;\n      let token = this.props.userPayload.token;\n      let name = this.props.userPayload.user.fullname || this.props.userPayload.user.email; // get list messages\n\n      this.getMessageIndividualUser(uid, toUid, token); // get user that send message to\n\n      let userFriend = await getUserById(toUid);\n      this.setState({\n        userFriend\n      });\n      this.handleCreateConnectSocket({\n        uid,\n        name\n      }, userFriend);\n    } catch (e) {\n      console.log(e);\n    }\n  }\n\n  componentWillUnmount() {\n    console.log(\"unmount\");\n  }\n\n  async componentWillReceiveProps(nextProps) {\n    try {\n      document.getElementById(\"text-message\").addEventListener(\"keyup\", this.checkUserEnter);\n      let {\n        toUid\n      } = nextProps.match.params;\n      let uid = this.props.userPayload.user._id;\n      let token = this.props.userPayload.token; // get list messages\n\n      this.setState({\n        messages: []\n      });\n      this.getMessageIndividualUser(uid, toUid, token); // get user that send message to\n\n      let userFriend = await getUserById(toUid);\n      this.setState({\n        userFriend\n      });\n    } catch (e) {\n      console.log(e);\n    }\n\n    console.log(\"receive\");\n  }\n\n  render() {\n    let {\n      userFriend,\n      messages\n    } = this.state;\n    let tabActive = document.querySelectorAll(\".item-discussions.active\");\n    Array.from(tabActive).map(el => {\n      el.classList.remove(\"active\");\n    }); // active tab\n\n    let idTabElement = `dcs_${userFriend._id}`;\n    let tabElement = document.getElementById(idTabElement);\n\n    if (tabElement) {\n      tabElement.classList.add(\"active\");\n    }\n\n    return React.createElement(Template, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"chat-area\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"top\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"inside\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"status online\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"data\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275\n      },\n      __self: this\n    }, React.createElement(\"h5\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 276\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      href: \"/users/\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 276\n      },\n      __self: this\n    }, userFriend.fullname || userFriend.email)), React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277\n      },\n      __self: this\n    }, \"Active now\")), React.createElement(\"button\", {\n      className: \"btn d-md-block audio-call\",\n      title: \"Audio call\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"ti-headphone-alt\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280\n      },\n      __self: this\n    })), React.createElement(\"button\", {\n      className: \"btn d-md-block audio-call\",\n      title: \"Audio call\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"ti-video-camera\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283\n      },\n      __self: this\n    })), React.createElement(\"button\", {\n      className: \"btn d-md-block audio-call\",\n      title: \"Audio call\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"ti-info\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"dropdown\",\n      onClick: this.toggleDropdown,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      className: \"btn d-md-block audio-call\",\n      title: \"Audio call\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"ti-gird\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"dropdown-list list-more\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      href: \"/\",\n      className: \"voice\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 295\n      },\n      __self: this\n    }, \"Voice Call\"), React.createElement(\"a\", {\n      href: \"/\",\n      className: \"voice\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 296\n      },\n      __self: this\n    }, \"Video Call\"), React.createElement(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297\n      },\n      __self: this\n    }), React.createElement(\"a\", {\n      href: \"/\",\n      className: \"voice\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298\n      },\n      __self: this\n    }, \"Clear History\"), React.createElement(\"a\", {\n      href: \"/\",\n      className: \"voice\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299\n      },\n      __self: this\n    }, \"Block Contact\"), React.createElement(\"a\", {\n      href: \"/\",\n      className: \"voice\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, \"Delete Contact\"))))), React.createElement(\"div\", {\n      className: \"content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306\n      },\n      __self: this\n    }, messages.map((msg, i) => {\n      console.log(msg);\n      return React.createElement(ItemMessage, {\n        key: i,\n        isMe: msg.isMe,\n        content: msg.content // contentPhoto={msg.photo}\n        ,\n        photo: msg.photo,\n        date: moment(msg.created).fromNow() || \"just now\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      });\n    }), React.createElement(\"div\", {\n      id: \"end-of-message\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 326\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"scroller\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"bottom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 330\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      className: \"text-area\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"typing-action\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332\n      },\n      __self: this\n    }, \"someone is typing ...\"), React.createElement(\"textarea\", {\n      id: \"text-message\",\n      className: \"form-control\",\n      placeholder: \"Start typing for reply...\",\n      rows: 1,\n      defaultValue: \"\",\n      onPaste: this.handlePasteToInput,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"add-smiles\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 339\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      title: \"add icon\",\n      className: \"em em-blush\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340\n      },\n      __self: this\n    })), React.createElement(\"button\", {\n      onClick: this.handleSendMessageFromIndividualUser,\n      style: {\n        height: '56x'\n      },\n      type: \"submit\",\n      className: \"btn send\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"ti-location-arrow\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343\n      },\n      __self: this\n    })), React.createElement(\"label\", {\n      className: \"label-input input-file\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"file\",\n      className: \"d-none\",\n      onChange: this.previewPhoto,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 345\n      },\n      __self: this\n    }), React.createElement(\"i\", {\n      className: \"ti-clip\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 349\n      },\n      __self: this\n    })))), React.createElement(\"div\", {\n      onClick: this.clearFormDataImage,\n      className: \"preview-image\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      id: \"preview\",\n      src: \"\",\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nexport default withRouter(ChatArea);","map":{"version":3,"sources":["/opt/lampp/htdocs/STUDY_SPACE/chat-app/src/chats/ChatArea.js"],"names":["React","withRouter","ItemMessage","Template","socketIOClient","getUserById","getMessageIndividualUser","postSavePrivateMessage","moment","require","ChatArea","Component","constructor","handleSendMessageFromIndividualUser","window","event","preventDefault","textMessage","document","getElementById","value","trim","formData","get","toUid","props","match","params","uid","userPayload","user","_id","photo","token","socket","emit","to","message","from","setState","messages","state","concat","isMe","content","querySelector","innerText","scrollToBottom","append","then","res","console","log","delete","urlContainImage","catch","err","e","handleCreateConnectSocket","data","userFriend","process","env","REACT_APP_API_URL","transports","on","username","name","email","currentUnread","Number","innerHTML","showUnReadMessage","senderId","receiverId","listMessage","countUnreadMessage","map","mes","objMessage","sender","date","created","receiver","isRead","push","count","classList","add","showTypingAction","uTyping","previewPhoto","reader","FileReader","inputAvatar","onload","src","result","readAsDataURL","target","files","handlePasteToInput","items","clipboardData","originalEvent","blob","i","length","type","indexOf","getAsFile","clearFormDataImage","remove","checkUserEnter","keyCode","toggleDropdown","drdElement","addEventListener","scrollIntoView","behavior","onlineUser","FormData","componentDidMount","fullname","componentWillUnmount","componentWillReceiveProps","nextProps","render","tabActive","querySelectorAll","Array","el","idTabElement","tabElement","msg","fromNow","height"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport ItemMessage from '../chats/ItemMessage';\n// import ItemMessageAttachment from '../chats/ItemMessageAttachment';\nimport Template from '../component/TemplateWithNavigation';\nimport socketIOClient from 'socket.io-client';\nimport { getUserById } from '../controllers/UserController';\nimport { getMessageIndividualUser, postSavePrivateMessage } from '../controllers/PrivateChat';\nconst moment = require(\"moment\");\n\nclass ChatArea extends React.Component {\n    constructor() {\n        super();\n        this.state = {\n            messages: [],\n            onlineUser: [],\n            userFriend: {}\n        }\n\n        this.formData = new FormData();\n    }\n\n    async componentDidMount() {\n        try {\n            document.getElementById(\"text-message\").addEventListener(\"keyup\", this.checkUserEnter);\n            let { toUid } = this.props.match.params;\n            let uid = this.props.userPayload.user._id;\n            let token = this.props.userPayload.token;\n            let name = this.props.userPayload.user.fullname || this.props.userPayload.user.email;\n            // get list messages\n            this.getMessageIndividualUser(uid, toUid, token)\n            // get user that send message to\n            let userFriend = await getUserById(toUid);\n            this.setState({ userFriend })\n\n            this.handleCreateConnectSocket({ uid, name }, userFriend);\n        } catch (e) { console.log(e) }\n    }\n    componentWillUnmount() {\n        console.log(\"unmount\")\n    }\n    async componentWillReceiveProps(nextProps) {\n        try {\n            document.getElementById(\"text-message\").addEventListener(\"keyup\", this.checkUserEnter);\n            let { toUid } = nextProps.match.params;\n            let uid = this.props.userPayload.user._id;\n            let token = this.props.userPayload.token;\n            // get list messages\n            this.setState({ messages: [] });\n            this.getMessageIndividualUser(uid, toUid, token)\n            // get user that send message to\n            let userFriend = await getUserById(toUid);\n            this.setState({ userFriend })\n\n\n        } catch (e) { console.log(e) }\n        console.log(\"receive\")\n    }\n\n    handleSendMessageFromIndividualUser = () => {\n        try {\n            window.event.preventDefault();\n            let textMessage = document.getElementById(\"text-message\");\n            if (textMessage.value.trim() || this.formData.get(\"photo\")) {\n                let { toUid } = this.props.match.params;\n                let uid = this.props.userPayload.user._id;\n                // let name = this.props.userPayload.user.fullname || this.props.userPayload.user.email;\n                let photo = this.props.userPayload.user.photo;\n                let token = this.props.userPayload.token;\n\n                // emit event\n                this.socket.emit(\"client-send-message-from-individual-user\", { to: toUid, message: textMessage.value, photo, from: uid }, () => {\n                    this.setState({ messages: this.state.messages.concat({ isMe: \"me\", content: textMessage.value }) });\n                    document.querySelector(`#dcs_${toUid} p`).innerText = textMessage.value;\n                    textMessage.value = \"\";\n                    this.scrollToBottom();\n                });\n\n\n                // save private message to db\n                this.formData.append(\"sender\", uid);\n                this.formData.append(\"receiver\", toUid);\n                this.formData.append(\"content\", textMessage.value);\n                postSavePrivateMessage(this.formData, token)\n                .then((res) => {\n                    console.log(res)\n                    this.formData.delete(\"photo\");\n                    if (res && res.urlContainImage) {\n                        // let dataImage = {\n                        //   sender: {\n                        //     _id: uid,\n                        //     name,\n                        //     photo: photo\n                        //   },\n                        //   photo: res.urlContainImage,\n                        // }\n                        // this.setState({\n                        //   messageList: this.state.messageList.concat(dataImage)\n                        // });\n\n                        // dataImage.chanelId = chanelId;\n                        // this.socket.emit(\"client-send-message-contain-image-from-individual-user\", dataImage, () => {\n                        //   \n                        // })\n                    }\n                })\n                .catch(err => console.log(err));\n            }\n\n        } catch (e) { console.log(e) }\n    }\n\n    handleCreateConnectSocket = (data, userFriend) => {\n        try {\n            this.socket = socketIOClient(process.env.REACT_APP_API_URL, { transports: ['websocket'] });\n            // wait client connect\n            this.socket.on('connect', () => {\n\n                this.socket.emit(\"join-individual\", { uid: data.uid, username: data.name }, () => {\n                    console.log(`user ${this.props.userPayload.user.email} joined`);\n                });\n\n                this.socket.on(\"server-send-message-from-individual-user\", (res) => {\n                    if (res.from === userFriend._id) {\n                        this.setState({ messages: this.state.messages.concat({ content: res.message, photo: res.photo }) });\n                    }\n                    document.querySelector(`#dcs_${res.from} p`).innerText = res.message;\n                    console.log(`#dcs_${userFriend.uid} .count-unread span`)\n                    let currentUnread = Number(document.querySelector(`#dcs_${userFriend._id} .count-unread span`).innerHTML) + 1;\n                    console.log(\"currentUnread\", currentUnread);\n                    this.showUnReadMessage(currentUnread, res.from);\n                });\n\n                this.socket.on(\"server-send-message-contain-image-from-individual-user\", (res) => {\n                    if (res.from === userFriend._id) {\n                        this.setState({ messages: this.state.messages.concat({ content: res.message, photo: res.photo }) });\n                    }\n                    console.log(\"server-send-message-contain-image-from-individual-user\", res.data);\n                    document.querySelector(`#dcs_${res.from} p`).innerText = res.message;\n                    let currentUnread = Number(document.querySelector(`#dcs_${userFriend._id} .count-unread span`).innerHTML) + 1;\n                    this.showUnReadMessage(currentUnread, res.from);\n                });\n            })\n        } catch (e) { console.log(e) }\n    }\n\n    getMessageIndividualUser = (senderId, receiverId, token) => {\n        getMessageIndividualUser(senderId, receiverId, token)\n            .then(res => {\n                console.log(res)\n                if (!res.message) {\n                    let listMessage = [];\n                    let countUnreadMessage = 0;\n                    res.map(mes => {\n                        let objMessage = {};\n                        let isMe = mes.sender._id === senderId ? true : false;\n                        objMessage.isMe = isMe === true ? \"me\" : \"\";\n                        objMessage.content = mes.content;\n                        objMessage.date = mes.created;\n                        objMessage.photo = isMe === true ? mes.receiver.photo : mes.sender.photo;\n                        if (mes.sender._id !== senderId && mes.isRead === false) countUnreadMessage += 1;\n                        listMessage.push(objMessage);\n                    });\n                    this.setState({ messages: this.state.messages.concat(listMessage) });\n                    this.showUnReadMessage(countUnreadMessage, receiverId);\n                }\n            })\n            .catch(err => {\n                console.log(err)\n            })\n    }\n\n    showUnReadMessage = (count, toUid) => {\n        try {\n            if (count > 0) {\n                document.querySelector(`#dcs_${toUid} .count-unread`).classList.add(\"on\");\n                document.querySelector(`#dcs_${toUid} .count-unread span`).innerHTML = count;\n            }\n        } catch (err) { console.log(err) }\n    }\n\n    showTypingAction = (uTyping) => {\n        try {\n            document.getElementById(\"typing-action\").classList.add(\"on\");\n        } catch (e) { console.log(e) }\n    }\n\n    previewPhoto = (event) => {\n        let reader = new FileReader();\n        document.querySelector('.preview-image').classList.add(\"on\");\n        let inputAvatar = document.querySelector('.preview-image #preview');\n        reader.onload = function () {\n            inputAvatar.src = reader.result;\n        }\n        try {\n            reader.readAsDataURL(event.target.files[0]);\n            this.formData.append(\"photo\", event.target.files[0]);\n        } catch (e) {\n            // do nothing\n        }\n    }\n    handlePasteToInput = (event) => {\n        try {\n            let items = (event.clipboardData || event.originalEvent.clipboardData).items;\n            // find pasted image among pasted items\n            let blob = null;\n            for (let i = 0; i < items.length; i++) {\n                if (items[i].type.indexOf(\"image\") === 0) {\n                    blob = items[i].getAsFile();\n                }\n            }\n            // load image if there is a pasted image\n            if (blob !== null) {\n                let reader = new FileReader();\n                reader.onload = function (event) {\n                    document.querySelector('.preview-image').classList.add(\"on\");\n                    document.querySelector(\".preview-image #preview\").src = this.result;\n                };\n                reader.readAsDataURL(blob);\n                this.formData.append(\"photo\", blob);\n            }\n        } catch (e) { console.log(e) }\n    }\n\n    clearFormDataImage = () => {\n        document.querySelector('.preview-image').classList.remove(\"on\");\n        document.querySelector('.preview-image #preview').src = \"\";\n        this.formData.delete(\"photo\");\n    }\n\n    checkUserEnter = (e) => {\n        if (e.keyCode === 13) {\n            try {\n                this.handleSendMessageFromIndividualUser();\n            } catch (e) { console.log(e) }\n        }\n    }\n\n    toggleDropdown = () => {\n        try {\n            let drdElement = document.querySelector(\"#chat-area .list-more\");\n            if (drdElement.classList.length > 2) {\n                drdElement.classList.remove(\"active\");\n            } else {\n                drdElement.classList.add(\"active\");\n                document.getElementById(\"root\").addEventListener(\"click\", () => {\n                    drdElement.classList.remove(\"active\");\n                });\n            }\n        } catch (e) { }\n    }\n    scrollToBottom = () => {\n        try {\n            document.querySelector(\"#end-of-message\").scrollIntoView({ behavior: \"smooth\" });\n        } catch (e) { }\n    }\n\n    render() {\n        let { userFriend, messages } = this.state;\n\n        let tabActive = document.querySelectorAll(\".item-discussions.active\");\n        Array.from(tabActive).map(el => { el.classList.remove(\"active\") });\n        // active tab\n        let idTabElement = `dcs_${userFriend._id}`;\n        let tabElement = document.getElementById(idTabElement);\n        if (tabElement) {\n            tabElement.classList.add(\"active\")\n        }\n        return (\n            <Template>\n                <div id=\"chat-area\">\n                    <div className=\"top\">\n                        <div className=\"inside\">\n                            <div className=\"status online\" />\n                            <div className=\"data\">\n                                <h5><a href=\"/users/\">{userFriend.fullname || userFriend.email}</a></h5>\n                                <span>Active now</span>\n                            </div>\n                            <button className=\"btn d-md-block audio-call\" title=\"Audio call\">\n                                <i className=\"ti-headphone-alt\" />\n                            </button>\n                            <button className=\"btn d-md-block audio-call\" title=\"Audio call\">\n                                <i className=\"ti-video-camera\" />\n                            </button>\n                            <button className=\"btn d-md-block audio-call\" title=\"Audio call\">\n                                <i className=\"ti-info\" />\n                            </button>\n\n                            <div className=\"dropdown\" onClick={this.toggleDropdown}>\n                                <button className=\"btn d-md-block audio-call\" title=\"Audio call\">\n                                    <i className=\"ti-gird\" />\n                                </button>\n\n                                <div className=\"dropdown-list list-more\">\n                                    <a href=\"/\" className=\"voice\">Voice Call</a>\n                                    <a href=\"/\" className=\"voice\">Video Call</a>\n                                    <hr />\n                                    <a href=\"/\" className=\"voice\">Clear History</a>\n                                    <a href=\"/\" className=\"voice\">Block Contact</a>\n                                    <a href=\"/\" className=\"voice\">Delete Contact</a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"content\">\n                        <div className=\"container\">\n                            {\n                                messages.map((msg, i) => {\n                                    console.log(msg)\n                                    return <ItemMessage\n                                        key={i}\n                                        isMe={msg.isMe}\n                                        content={msg.content}\n                                        // contentPhoto={msg.photo}\n                                        photo={msg.photo}\n                                        date={moment(msg.created).fromNow() || \"just now\"}\n                                    />\n                                })\n                            }\n                            {/* <div className=\"date\">\n                    <hr />\n                    <span>Yesterday</span>\n                    <hr />\n                  </div>\n              */}\n                            <div id=\"end-of-message\"></div>\n                        </div>\n                        <div className=\"scroller\" />\n                    </div>\n                    <div className=\"bottom\">\n                        <form className=\"text-area\">\n                            <div id=\"typing-action\">\n                                someone is typing ...\n              </div>\n                            <textarea\n                                id=\"text-message\" className=\"form-control\" placeholder=\"Start typing for reply...\" rows={1} defaultValue={\"\"}\n                                onPaste={this.handlePasteToInput}\n                            />\n                            <div className=\"add-smiles\">\n                                <span title=\"add icon\" className=\"em em-blush\" />\n                            </div>\n\n                            <button onClick={this.handleSendMessageFromIndividualUser} style={{ height: '56x' }} type=\"submit\" className=\"btn send\"><i className=\"ti-location-arrow\" /></button>\n                            <label className=\"label-input input-file\">\n                                <input\n                                    type=\"file\" className=\"d-none\"\n                                    onChange={this.previewPhoto}\n                                />\n                                <i className=\"ti-clip\" />\n                            </label>\n                        </form>\n                    </div>\n                    <div onClick={this.clearFormDataImage} className=\"preview-image\">\n                        <img id=\"preview\" src=\"\" alt=\"\" />\n                    </div>\n                </div>\n                {/* <div id=\"call-area\">\n            </div> */}\n            </Template>\n        )\n\n    }\n}\n\nexport default withRouter(ChatArea);"]},"metadata":{},"sourceType":"module"}